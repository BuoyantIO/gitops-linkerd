apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: faces
resources:
  - namespace.yaml
  - faces-sync.yaml
  - faces-ingress.yaml
  - faces-canary.yaml
  - faces-abtest.yaml
  - faces.yaml
patches:
  - patch: |
      - op: add
        path: /spec/template/spec/containers/0/env
        value:
          - name: FACES_SERVICE
            value: "smiley"
          - name: ERROR_FRACTION
            value: "20"
          - name: DELAY_BUCKETS
            value: "0,5,10,15,20,50,200,500,1500"
          - name: SMILEY
            value: "HeartEyes"
    target:
      kind: Deployment
      name: smiley
  - patch: |
      - op: replace
        path: /spec/template/spec/containers/0/env/1
        value:
          name: ERROR_FRACTION
          value: "0"
    target:
      kind: Deployment
      name: (face|color)
  - patch: |
      - op: add
        path: /spec/template/spec/containers/0/env
        value:
          - name: ERROR_FRACTION
            value: "0"
          - name: COLOR_foo
            value: lightgray
    target:
      kind: Deployment
      name: faces-gui